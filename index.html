<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>ÁÑ°Â∞æÁÜäË®±È°òÊ±† üê®‚ú®</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="theme-color" content="#f8bbd0">
    
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&family=Zen+Maru+Gothic:wght@500;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-color: #fff0f5;
            --board-bg: #fce4ec;
            --text-main: #880e4f;
            --accent: #ec407a;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-color);
            font-family: 'Zen Maru Gothic', sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex; flex-direction: column;
            color: var(--text-main);
        }

        .nav-bar {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: white; padding: 10px 30px; border-radius: 40px;
            display: flex; gap: 40px; box-shadow: 0 10px 30px rgba(233, 30, 99, 0.15);
            z-index: 1000;
        }
        .nav-item {
            font-size: 1.5rem; color: #f8bbd0; cursor: pointer; transition: 0.3s;
            width: 50px; height: 50px; display: flex; justify-content: center; align-items: center;
            border-radius: 50%;
        }
        .nav-item.active { background: var(--accent); color: white; transform: translateY(-10px); box-shadow: 0 5px 15px rgba(233, 30, 99, 0.3); }

        .page {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.3s, transform 0.3s; opacity: 0; pointer-events: none;
        }
        .page.active { opacity: 1; pointer-events: all; transform: scale(1); }

        #game-wrapper {
            width: 100%; max-width: 500px; height: 100%; padding: 20px 20px 100px 20px;
            display: flex; flex-direction: column; justify-content: space-between;
        }
        header { width: 100%; display: flex; justify-content: space-between; align-items: center; }
        .score-box {
            background: white; padding: 8px 15px; border-radius: 20px;
            box-shadow: 0 5px 10px rgba(233, 30, 99, 0.05); text-align: center; min-width: 80px;
        }
        .score-val { font-size: 1.2rem; font-weight: 900; font-family: 'Fredoka'; color: var(--accent); }
        
        #board-container {
            width: 100%; aspect-ratio: 1/1; background: var(--board-bg);
            border-radius: 16px; padding: 10px; box-shadow: inset 0 5px 15px rgba(0,0,0,0.05);
        }
        canvas#game-canvas { width: 100%; height: 100%; border-radius: 8px; display: block; }
        #spawn-area { width: 100%; height: 120px; display: flex; justify-content: space-around; align-items: center; }
        
        .shape-preview { width: 70px; height: 70px; transition: transform 0.1s; }
        .shape-preview.dragging { opacity: 0.9; z-index: 2000; position: fixed; transform: scale(1.2); pointer-events: none; }

        #shop-wrapper {
            width: 100%; max-width: 500px; height: 100%; padding: 60px 20px 100px 20px;
            display: flex; flex-direction: column; align-items: center;
            overflow-y: auto;
        }
        
        .wallet-card {
            background: linear-gradient(135deg, #ec407a, #d81b60);
            color: white; width: 100%; padding: 20px; border-radius: 20px;
            box-shadow: 0 10px 20px rgba(233, 30, 99, 0.2); margin-bottom: 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .coin-display { font-size: 2rem; font-weight: 900; font-family: 'Fredoka'; }
        
        .shop-list { width: 100%; display: flex; flex-direction: column; gap: 15px; }
        
        .coupon-item {
            background: white; border-radius: 15px; padding: 15px;
            display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: 0.2s;
            border: 2px solid transparent;
        }
        .coupon-item:active { transform: scale(0.98); }
        .coupon-icon { font-size: 2.5rem; margin-right: 15px; width: 50px; text-align: center; }
        .coupon-info { flex: 1; }
        .coupon-name { font-weight: bold; font-size: 1.1rem; color: #333; }
        .coupon-price { color: #ec407a; font-weight: bold; font-size: 0.9rem; margin-top: 5px; }
        .btn-redeem {
            background: #ec407a; color: white; border: none; padding: 8px 15px;
            border-radius: 20px; font-weight: bold; cursor: pointer;
        }
        .btn-redeem:disabled { background: #ccc; }

        #secret-btn {
            position: fixed; top: 10px; right: 10px; opacity: 0.05; font-size: 1.5rem;
            z-index: 3000; cursor: pointer;
        }

        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 4000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            display: none;
        }
        .overlay-card {
            background: white; padding: 30px; border-radius: 20px; width: 85%; max-width: 400px;
            text-align: center; max-height: 80vh; overflow-y: auto;
        }
        .log-list { list-style: none; text-align: left; margin-top: 15px; }
        .log-item { 
            border-bottom: 1px solid #eee; padding: 10px 0; display: flex; justify-content: space-between;
            font-size: 0.9rem;
        }

        .float-text {
            position: absolute; font-family: 'Fredoka'; font-weight: 900;
            color: #ec407a; font-size: 2rem; pointer-events: none;
            text-shadow: 2px 2px 0px white; z-index: 3000;
            animation: floatUp 1s forwards;
        }
        @keyframes floatUp { 0% { transform:translateY(0) scale(0.5); opacity:0; } 50% { transform:translateY(-50px) scale(1.2); opacity:1; } 100% { transform:translateY(-80px) scale(1); opacity:0; } }
    </style>
</head>
<body>

<!-- Èö±ËóèÂæåÂè∞ÊåâÈàï -->
<div id="secret-btn" onclick="Admin.showLogs()">‚öôÔ∏è</div>

<div class="nav-bar">
    <div class="nav-item active" onclick="switchPage('game')">
        <i class="fas fa-gamepad"></i>
    </div>
    <div class="nav-item" onclick="switchPage('shop')">
        <i class="fas fa-gift"></i>
    </div>
</div>

<div id="game-page" class="page active">
    <div id="game-wrapper">
        <header>
            <!-- ÁßòÂØÜÈªûÊìäÂçÄÂüüÔºöÊ®ôÈ°å -->
            <div id="title-trigger" style="font-weight:bold; color:var(--text-main); font-size:1.2rem; cursor:pointer;">ÁÑ°Â∞æÁÜäË®±È°òÊ±† üê®</div>
            <div class="score-box">
                <div style="font-size:0.7rem; color:#888;">ÊÑõÂøÉÂπ£</div>
                <div class="score-val" id="game-coins">0</div>
            </div>
        </header>

        <div id="board-container">
            <canvas id="game-canvas" width="800" height="800"></canvas>
        </div>
        <div id="spawn-area"></div>
    </div>
</div>

<div id="shop-page" class="page">
    <div id="shop-wrapper">
        <div class="wallet-card">
            <div>
                <div style="font-size:0.8rem; opacity:0.8;">ÁõÆÂâçÊåÅÊúâÊÑõÂøÉÂπ£</div>
                <div class="coin-display" id="total-coins">0</div>
            </div>
            <i class="fas fa-heart" style="font-size:3rem; opacity:0.5;"></i>
        </div>

        <h3 style="margin-bottom:15px; color:var(--text-main); align-self:flex-start;">‚ú® ÂÖåÊèõÂ¶≥ÁöÑÈ°òÊúõ</h3>
        <div class="shop-list" id="shop-container"></div>
    </div>
</div>

<div id="overlay">
    <div class="overlay-card">
        <h3>üìã ÂÖåÊèõÁ¥ÄÈåÑ (ÂæåÂè∞)</h3>
        <div id="loading-text">ËºâÂÖ•‰∏≠...</div>
        <ul class="log-list" id="log-list"></ul>
        <button onclick="Admin.close()" style="margin-top:20px; padding:10px 30px; border:none; background:#ccc; border-radius:20px;">ÈóúÈñâ</button>
    </div>
</div>

<script>
    /* =================================================================
       ‚ö†Ô∏è Ë®≠ÂÆöÂçÄÔºöË´ãÂú®Ê≠§Â°´ÂÖ•‰Ω†ÁöÑ Dreamlo Keys
    ================================================================= */
    const DreamloConfig = {
        privateKey: "", 
        publicKey:  "", 
    };

    /* ‚ö†Ô∏è ÁçéÂìÅÂàóË°® (ÈÄöË≤®ËÜ®ËÑπÁâà) */
    const REAL_PRIZES = [
        { id: 'tea', name: '‰∏ÄÊùØÊâãÊêñÈ£≤', price: 2500, icon: 'üßã' },
        { id: 'massage', name: 'ËÇ©È†∏ÊåâÊë© (20ÂàÜ)', price: 12000, icon: 'üíÜ‚Äç‚ôÄÔ∏è' },
        { id: 'food', name: 'Ë´ãÂêÉÂ§ßÈ§ê', price: 35000, icon: 'üçΩÔ∏è' },
        { id: 'movie', name: 'ÈõªÂΩ±‰πãÂ§ú', price: 50000, icon: 'üé¨' },
        { id: 'wish', name: 'ÁÑ°Ê¢ù‰ª∂È°òÊúõÂà∏', price: 200000, icon: 'üßû‚Äç‚ôÇÔ∏è' },
        { id: 'cart', name: 'Ê∏ÖÁ©∫Ë≥ºÁâ©Ëªä', price: 999999, icon: 'üõçÔ∏è' }
    ];

    /* =========================================
       1. Ë≥áÊñôËàáÂïÜÂ∫óÁ≥ªÁµ±
    ========================================= */
    let userCoins = parseInt(localStorage.getItem('xr_love_coins') || 0);

    function updateUI() {
        document.getElementById('total-coins').innerText = userCoins;
        document.getElementById('game-coins').innerText = userCoins;
        localStorage.setItem('xr_love_coins', userCoins);
        renderShop();
    }

    function renderShop() {
        const container = document.getElementById('shop-container');
        container.innerHTML = '';
        REAL_PRIZES.forEach(item => {
            const canBuy = userCoins >= item.price;
            const div = document.createElement('div');
            div.className = 'coupon-item';
            div.innerHTML = `
                <div class="coupon-icon">${item.icon}</div>
                <div class="coupon-info">
                    <div class="coupon-name">${item.name}</div>
                    <div class="coupon-price">${item.price.toLocaleString()} ÊÑõÂøÉÂπ£</div>
                </div>
                <button class="btn-redeem" ${canBuy ? '' : 'disabled'} onclick="redeemItem('${item.name}', ${item.price})">
                    ${canBuy ? 'ÂÖåÊèõ' : '‰∏çË∂≥'}
                </button>
            `;
            container.appendChild(div);
        });
    }

    function redeemItem(itemName, price) {
        if(confirm(`Á¢∫ÂÆöË¶ÅËä± ${price} ÊÑõÂøÉÂπ£ÂÖåÊèõ„Äå${itemName}„ÄçÂóéÔºü`)) {
            userCoins -= price;
            updateUI();
            Admin.uploadLog(itemName);
            alert(`üéâ ÂÖåÊèõÊàêÂäüÔºÅ\n\nÂ¶≥Áç≤Âæó‰∫ÜÔºö${itemName}\n\n(Á≥ªÁµ±Â∑≤ÂÅ∑ÂÅ∑ÈÄöÁü•Áî∑ÂèãÊ∫ñÂÇôÂ±•Á¥Ñ)`);
        }
    }

    /* ÁßòÂØÜÈñãÊéõÂäüËÉΩ */
    let clickCount = 0;
    document.getElementById('title-trigger').addEventListener('click', () => {
        clickCount++;
        if(clickCount === 10) {
            userCoins += 10000;
            updateUI();
            alert("üíñ Áî∑ÂèãÊïëÊòüÂïüÂãïÔºÅ\nÂ∑≤ÂÅ∑ÂÅ∑ÂåØÂÖ• 10,000 ÊÑõÂøÉÂπ£„ÄÇ");
            clickCount = 0;
        }
    });

    /* =========================================
       2. ÂæåÂè∞Á≥ªÁµ±
    ========================================= */
    const Admin = {
        uploadLog: function(itemName) {
            if(!DreamloConfig.privateKey) return;
            const msg = `ÂÖåÊèõÔºö${itemName}`;
            const score = 2000000000 - Math.floor(Date.now() / 1000); 
            const uniqueName = `${msg}_${Math.floor(Math.random()*100)}`;
            const url = `https://www.dreamlo.com/lb/${DreamloConfig.privateKey}/add/${encodeURIComponent(uniqueName)}/${score}`;
            fetch(url).catch(e => console.log("Upload failed"));
        },
        showLogs: function() {
            document.getElementById('overlay').style.display = 'flex';
            const list = document.getElementById('log-list');
            const loading = document.getElementById('loading-text');
            list.innerHTML = '';
            loading.style.display = 'block';
            if(!DreamloConfig.publicKey) { loading.innerText = "Â∞öÊú™Ë®≠ÂÆö API Key"; return; }
            const url = `https://www.dreamlo.com/lb/${DreamloConfig.publicKey}/json`;
            fetch(url).then(res => res.json()).then(data => {
                loading.style.display = 'none';
                let entries = [];
                if(data.dreamlo && data.dreamlo.leaderboard && data.dreamlo.leaderboard.entry) {
                    entries = data.dreamlo.leaderboard.entry;
                    if(!Array.isArray(entries)) entries = [entries];
                }
                if(entries.length === 0) { list.innerHTML = '<li>Â∞öÁÑ°ÂÖåÊèõÁ¥ÄÈåÑ</li>'; return; }
                entries.forEach(entry => {
                    let displayName = entry.name.split('_')[0];
                    const li = document.createElement('li');
                    li.className = 'log-item';
                    li.innerHTML = `<span style="font-weight:bold; color:#880e4f;">${displayName}</span><span style="color:#ec407a;">Â∑≤ÂÖåÊèõ</span>`;
                    list.appendChild(li);
                });
            }).catch(e => loading.innerText = "ËÆÄÂèñÂ§±Êïó");
        },
        close: function() { document.getElementById('overlay').style.display = 'none'; }
    };

    /* =========================================
       3. È†ÅÈù¢ÂàáÊèõËàáÈÅäÊà≤
    ========================================= */
    function switchPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(`${pageId}-page`).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        event.currentTarget.classList.add('active');
        if(pageId === 'shop') updateUI();
    }

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const Sound = {
        play: (freq, type, dur) => {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
            o.type = type; o.frequency.setValueAtTime(freq, audioCtx.currentTime);
            g.gain.setValueAtTime(0.1, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
            o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + dur);
        },
        pickup: () => Sound.play(400, 'sine', 0.1),
        drop: () => Sound.play(200, 'triangle', 0.1),
        clear: (n) => { for(let i=0;i<n;i++) setTimeout(()=>Sound.play(440*(1+i*0.5),'sine',0.3), i*50); }
    };

    const SHAPES = [
        { m: [[1]], color: '#ef9a9a' }, { m: [[1,1]], color: '#f48fb1' }, { m: [[1],[1]], color: '#ce93d8' },
        { m: [[1,1,1]], color: '#b39ddb' }, { m: [[1,1],[1,1]], color: '#90caf9' },
        { m: [[1,1,1],[0,1,0]], color: '#80cbc4' }, { m: [[1,0],[1,0],[1,1]], color: '#a5d6a7' },
        { m: [[1,1,1,1]], color: '#e6ee9c' }
    ];

    class BlockPuzzle {
        constructor() {
            this.canvas = document.getElementById('game-canvas');
            this.ctx = this.canvas.getContext('2d');
            this.gridSize = 8;
            this.cellSize = this.canvas.width / this.gridSize;
            this.grid = Array(this.gridSize).fill().map(() => Array(this.gridSize).fill(0));
            this.TOUCH_OFFSET = 100;
            this.currentShape = null;
            this.ghostShape = null;
            this.loop = this.loop.bind(this);
            requestAnimationFrame(this.loop);
            this.spawnShapes();
            updateUI();
        }
        loop() {
            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
            this.drawGrid();
            if (this.ghostShape) this.drawGhost();
            this.drawPlacedBlocks();
            requestAnimationFrame(this.loop);
        }
        drawGrid() {
            this.ctx.strokeStyle = 'white'; this.ctx.lineWidth = 2;
            for(let i=0; i<=this.gridSize; i++) {
                let pos = i * this.cellSize;
                this.ctx.beginPath(); this.ctx.moveTo(0, pos); this.ctx.lineTo(800, pos); this.ctx.stroke();
                this.ctx.beginPath(); this.ctx.moveTo(pos, 0); this.ctx.lineTo(pos, 800); this.ctx.stroke();
            }
        }
        drawGhost() {
            const { x, y, shape } = this.ghostShape;
            this.ctx.save(); this.ctx.globalAlpha = 0.4;
            for(let r=0; r<shape.m.length; r++) {
                for(let c=0; c<shape.m[0].length; c++) {
                    if(shape.m[r][c]) this.drawCell(x + c, y + r, shape.color); 
                }
            }
            this.ctx.restore();
        }
        drawPlacedBlocks() {
            for(let r=0; r<this.gridSize; r++) {
                for(let c=0; c<this.gridSize; c++) {
                    if(this.grid[r][c] !== 0) this.drawCell(c, r, this.grid[r][c]);
                }
            }
        }
        drawCell(x, y, color) {
            const padding = 4; const size = this.cellSize - padding * 2;
            const cx = x * this.cellSize + this.cellSize/2; const cy = y * this.cellSize + this.cellSize/2;
            this.ctx.save(); this.ctx.translate(cx, cy);
            this.ctx.fillStyle = color;
            this.ctx.beginPath(); this.ctx.roundRect(-size/2, -size/2, size, size, 10); this.ctx.fill();
            this.ctx.fillStyle = 'rgba(255,255,255,0.3)';
            this.ctx.beginPath(); this.ctx.arc(-size/4, -size/4, size/6, 0, Math.PI*2); this.ctx.fill();
            this.ctx.restore();
        }
        spawnShapes() {
            const container = document.getElementById('spawn-area');
            container.innerHTML = '';
            for(let i=0; i<3; i++) {
                const shapeData = SHAPES[Math.floor(Math.random() * SHAPES.length)];
                this.createDraggableShape(shapeData, container);
            }
        }
        createDraggableShape(data, container) {
            const el = document.createElement('canvas');
            el.width = 70; el.height = 70; el.className = 'shape-preview';
            const ctx = el.getContext('2d');
            const rows = data.m.length; const cols = data.m[0].length;
            const size = 12; const offsetX = (70 - cols*size)/2; const offsetY = (70 - rows*size)/2;
            ctx.fillStyle = data.color;
            for(let r=0; r<rows; r++) {
                for(let c=0; c<cols; c++) {
                    if(data.m[r][c]) { ctx.beginPath(); ctx.roundRect(offsetX + c*size, offsetY + r*size, size-2, size-2, 3); ctx.fill(); }
                }
            }
            const handleStart = (e) => {
                e.preventDefault(); Sound.pickup(); el.classList.add('dragging');
                this.currentShape = { el, data, startX: e.clientX || e.touches[0].clientX, startY: e.clientY || e.touches[0].clientY };
                this.moveShape(e);
            };
            el.addEventListener('mousedown', handleStart); el.addEventListener('touchstart', handleStart);
            container.appendChild(el);
        }
        moveShape(e) {
            const move = (ev) => {
                if(!this.currentShape) return;
                const cx = ev.clientX || ev.touches[0].clientX; const cy = ev.clientY || ev.touches[0].clientY;
                const el = this.currentShape.el;
                el.style.left = (cx - 35) + 'px'; el.style.top = (cy - 35 - this.TOUCH_OFFSET) + 'px';
                const rect = this.canvas.getBoundingClientRect();
                const x = (cx - rect.left) * (this.canvas.width / rect.width);
                const y = (cy - this.TOUCH_OFFSET - rect.top) * (this.canvas.height / rect.height);
                const gx = Math.floor(x / this.cellSize); const gy = Math.floor(y / this.cellSize);
                const shape = this.currentShape.data;
                const finalX = gx - Math.floor(shape.m[0].length/2); const finalY = gy - Math.floor(shape.m.length/2);
                if(this.canPlace(shape.m, finalX, finalY)) {
                    this.ghostShape = { x: finalX, y: finalY, shape: shape };
                } else { this.ghostShape = null; }
            };
            const end = (ev) => {
                document.removeEventListener('mousemove', move); document.removeEventListener('touchmove', move);
                document.removeEventListener('mouseup', end); document.removeEventListener('touchend', end);
                if(!this.currentShape) return;
                const cx = ev.clientX || (ev.changedTouches ? ev.changedTouches[0].clientX : 0);
                const cy = ev.clientY || (ev.changedTouches ? ev.changedTouches[0].clientY : 0);
                this.tryPlaceShape(cx, cy);
            };
            document.addEventListener('mousemove', move); document.addEventListener('touchmove', move, {passive: false});
            document.addEventListener('mouseup', end); document.addEventListener('touchend', end);
        }
        tryPlaceShape(mx, my) {
            this.ghostShape = null;
            const rect = this.canvas.getBoundingClientRect();
            const x = (mx - rect.left) * (this.canvas.width / rect.width);
            const y = (my - this.TOUCH_OFFSET - rect.top) * (this.canvas.height / rect.height);
            const gx = Math.floor(x / this.cellSize); const gy = Math.floor(y / this.cellSize);
            const shape = this.currentShape.data;
            const finalX = gx - Math.floor(shape.m[0].length/2); const finalY = gy - Math.floor(shape.m.length/2);
            if(this.canPlace(shape.m, finalX, finalY)) {
                this.place(shape, finalX, finalY);
                this.currentShape.el.remove(); Sound.drop();
                if(document.getElementById('spawn-area').children.length === 0) setTimeout(() => this.spawnShapes(), 500);
            } else {
                this.currentShape.el.classList.remove('dragging');
                this.currentShape.el.style.position = ''; this.currentShape.el.style.left = ''; this.currentShape.el.style.top = '';
            }
            this.currentShape = null;
        }
        canPlace(matrix, x, y) {
            for(let r=0; r<matrix.length; r++) {
                for(let c=0; c<matrix[0].length; c++) {
                    if(matrix[r][c]) {
                        const nx = x + c; const ny = y + r;
                        if(nx < 0 || nx >= this.gridSize || ny < 0 || ny >= this.gridSize || this.grid[ny][nx] !== 0) return false;
                    }
                }
            }
            return true;
        }
        place(shape, x, y) {
            for(let r=0; r<shape.m.length; r++) {
                for(let c=0; c<shape.m[0].length; c++) {
                    if(shape.m[r][c]) this.grid[y+r][x+c] = shape.color;
                }
            }
            this.checkLines();
        }
        checkLines() {
            let rowsToClear = []; let colsToClear = [];
            for(let r=0; r<this.gridSize; r++) if(this.grid[r].every(cell => cell !== 0)) rowsToClear.push(r);
            for(let c=0; c<this.gridSize; c++) {
                let full = true; for(let r=0; r<this.gridSize; r++) if(this.grid[r][c] === 0) full = false;
                if(full) colsToClear.push(c);
            }
            const totalLines = rowsToClear.length + colsToClear.length;
            if(totalLines > 0) {
                rowsToClear.forEach(r => this.grid[r].fill(0));
                colsToClear.forEach(c => { for(let r=0; r<this.gridSize; r++) this.grid[r][c] = 0; });
                Sound.clear(totalLines);
                let coinsEarned = totalLines * 10;
                if(totalLines > 1) coinsEarned *= totalLines;
                userCoins += coinsEarned;
                updateUI();
                this.showFloatText(`+${coinsEarned} ‚ù§Ô∏è`);
            }
        }
        showFloatText(text) {
            const el = document.createElement('div'); el.className = 'float-text'; el.innerText = text;
            el.style.left = '50%'; el.style.top = '40%'; el.style.transform = 'translate(-50%, -50%)';
            document.body.appendChild(el); setTimeout(() => el.remove(), 1000);
        }
    }
    const game = new BlockPuzzle();
    document.body.addEventListener('touchmove', function(e) { e.preventDefault(); }, { passive: false });
</script>
</body>
</html>
